process {

    publishDir = { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" }

    // NOTE: collate needs to creata temporary files. CI sets TMPDIR to ~,
    // which is not mounted any more in Singularity since Nextflow 23.10. We
    // add "-T ." so that the temporary files are created in a writable
    // location.

    withName: SAMTOOLS_PIPELINE_SORMADUP {
        ext.args  = '-T .'     // collate
        ext.args2 = '-m'       // fixmate
    }

    withName: SAMTOOLS_PIPELINE_COLLFIXMSORT {
        ext.args  = '-T .'     // collate
        ext.args2 = '-m'       // fixmate
    }

    withName: SAMTOOLS_PIPELINE_COLLFIXM {
        ext.args  = '-T .'     // collate
        ext.args2 = '-m'       // fixmate
    }

    withName: SAMTOOLS_PIPELINE_ALL {
        ext.args  = '-T .'                 // collate
        ext.args2 = '-r ID:FOO'            // addreplacerg
        ext.args3 = '-m'                   // fixmate
        ext.args4 = '-c "sed s/FOO/BAR/"'  // reheader
        ext.args7 = '-F 0x08'              // view
    }
}
